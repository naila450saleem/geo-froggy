<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoData Pro Portal | Professional Data Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-alpine.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.0/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    /* Professional Color Scheme */
    --primary-color: #2563eb;
    --primary-dark: #1d4ed8;
    --secondary-color: #64748b;
    --accent-color: #3b82f6;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --danger-color: #ef4444;
    --info-color: #06b6d4;
    
    /* Neutrals */
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-tertiary: #f1f5f9;
    --border-color: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-tertiary: #94a3b8;
    
    /* Shadows */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    
    /* Border Radius */
    --radius-sm: 0.25rem;
    --radius-md: 0.375rem;
    --radius-lg: 0.5rem;
    --radius-xl: 0.75rem;
}

/* Dark Mode Variables */
.dark-mode {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-tertiary: #334155;
    --border-color: #475569;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-tertiary: #94a3b8;
}

/* High Contrast Mode */
.high-contrast {
    --bg-primary: #000000;
    --bg-secondary: #111111;
    --border-color: #ffffff;
    --text-primary: #ffffff;
    --text-secondary: #cccccc;
    --primary-color: #00ffff;
    --danger-color: #ff0000;
    --success-color: #00ff00;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    transition: background-color 0.3s, color 0.3s;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
}

/* Age Switcher */
.age-switcher {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
    border-bottom: 1px solid var(--border-color);
    padding: var(--spacing-sm) 0;
}

.age-switcher .container {
    display: flex;
    justify-content: center;
    gap: var(--spacing-sm);
}

.mode-btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    border: 2px solid transparent;
    background: var(--bg-primary);
    color: var(--text-secondary);
    border-radius: var(--radius-lg);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.mode-btn:hover {
    border-color: var(--border-color);
    color: var(--text-primary);
}

.mode-btn.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
}

/* Main Header */
.main-header {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: var(--spacing-md) 0;
}

.main-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo-section h1 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.tagline {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-top: var(--spacing-xs);
}

.user-actions {
    display: flex;
    gap: var(--spacing-md);
    align-items: center;
}

.btn-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid var(--border-color);
    background: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-icon:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.btn-outline {
    padding: var(--spacing-sm) var(--spacing-lg);
    border: 1px solid var(--border-color);
    background: transparent;
    color: var(--text-primary);
    border-radius: var(--radius-md);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.btn-outline:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
}

/* Main Navigation */
.main-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: var(--spacing-sm) 0;
}

.main-nav .container {
    display: flex;
    align-items: center;
    gap: var(--spacing-xl);
}

.nav-link {
    padding: var(--spacing-sm) 0;
    color: var(--text-secondary);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.nav-link:hover,
.nav-link.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
}

.nav-right {
    margin-left: auto;
}

.session-info {
    font-size: 0.875rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

/* Search Section */
.search-section {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
    padding: var(--spacing-xl) 0;
    border-bottom: 1px solid var(--border-color);
}

.search-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.search-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.pro-features {
    display: flex;
    gap: var(--spacing-sm);
}

.btn-small {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-color);
    background: var(--bg-primary);
    color: var(--text-primary);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.btn-small:hover {
    background: var(--bg-tertiary);
}

.btn-small.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-primary {
    background: var(--primary-color);
    color: white;
    border: 1px solid var(--primary-color);
}

.btn-primary:hover {
    background: var(--primary-dark);
}

.search-container {
    margin-bottom: var(--spacing-lg);
}

.search-input-group {
    display: flex;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
}

.search-input {
    flex: 1;
    padding: var(--spacing-md) var(--spacing-lg);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all 0.2s;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.query-examples {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.example-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.query-example {
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
}

.query-example:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

/* Filters Panel */
.filters-panel {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
}

.filters-panel.collapsed .filters-grid {
    display: none;
}

.filters-header {
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.filters-header h3 {
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.btn-icon-small {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    background: var(--bg-primary);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.filters-grid {
    padding: var(--spacing-lg);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-xl);
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.filter-label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

/* Time Range */
.time-range {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.range-slider {
    position: relative;
    height: 4px;
    background: var(--border-color);
    border-radius: 2px;
    margin: var(--spacing-lg) 0;
}

.range-slider .slider {
    position: absolute;
    width: 100%;
    height: 4px;
    background: var(--primary-color);
    border-radius: 2px;
    outline: none;
    -webkit-appearance: none;
}

.range-values {
    display: flex;
    justify-content: space-between;
    margin-top: var(--spacing-md);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.year-inputs {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.year-input {
    width: 80px;
    padding: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
}

/* Category Tags */
.category-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
}

.category-tag {
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.category-tag input[type="checkbox"] {
    display: none;
}

.category-tag.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.category-tag:hover:not(.active) {
    background: var(--bg-secondary);
}

/* Select Styles */
.multi-select {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.sort-options {
    display: flex;
    gap: var(--spacing-sm);
}

.sort-select {
    flex: 1;
    padding: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.875rem;
}

/* Dashboard Content */
.dashboard-content {
    padding: var(--spacing-xl) 0;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.section-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

/* Insights Grid */
.insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
}

.insight-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    transition: all 0.2s;
    display: flex;
    gap: var(--spacing-lg);
}

.insight-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.insight-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.trend-up {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.trend-down {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.trend-neutral {
    background: rgba(59, 130, 246, 0.1);
    color: var(--primary-color);
}

.insight-content {
    flex: 1;
}

.insight-content h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-sm);
}

.insight-content p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-sm);
}

.insight-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--text-tertiary);
}

.confidence {
    color: var(--success-color);
    font-weight: 500;
}

/* Visualizations */
.viz-controls {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

.viz-select {
    padding: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.viz-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
}

.viz-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all 0.2s;
}

.viz-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.viz-card.wide {
    grid-column: span 2;
}

.viz-header {
    padding: var(--spacing-md) var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.viz-header h3 {
    font-size: 1rem;
    font-weight: 600;
}

.viz-actions {
    display: flex;
    gap: var(--spacing-sm);
}

.viz-action {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    background: var(--bg-primary);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.viz-action:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
}

.viz-container {
    padding: var(--spacing-lg);
    height: 300px;
    position: relative;
}

.viz-footer {
    padding: var(--spacing-md) var(--spacing-lg);
    border-top: 1px solid var(--border-color);
    background: var(--bg-secondary);
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--text-tertiary);
}

.legend {
    display: flex;
    gap: var(--spacing-lg);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.75rem;
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 2px;
}

/* Heatmap */
.heatmap-placeholder {
    height: 100%;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.heatmap-legend {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.heatmap-gradient {
    flex: 1;
    height: 8px;
    background: linear-gradient(to right, #3b82f6, #10b981, #f59e0b, #ef4444);
    border-radius: 4px;
}

/* Data Table Section */
.table-controls {
    display: flex;
    gap: var(--spacing-sm);
    align-items: center;
}

.rows-control {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.table-container {
    height: 500px;
    margin-bottom: var(--spacing-lg);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.table-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md) 0;
}

.pagination {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.page-info {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.table-stats {
    display: flex;
    gap: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.data-size {
    font-weight: 500;
}

/* Copedia Section */
.search-glossary {
    display: flex;
    gap: var(--spacing-sm);
}

.search-input-small {
    width: 200px;
    padding: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.copedia-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-lg);
}

.copedia-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    transition: all 0.2s;
}

.copedia-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.copedia-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-md);
    background: rgba(37, 99, 235, 0.1);
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: var(--spacing-md);
}

.copedia-card h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-sm);
}

.copedia-card p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-md);
    line-height: 1.5;
}

.copedia-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.category {
    font-size: 0.75rem;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border-radius: var(--radius-sm);
}

.learn-more {
    font-size: 0.75rem;
    color: var(--primary-color);
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 500;
}

.learn-more:hover {
    text-decoration: underline;
}

/* Footer */
.main-footer {
    background: var(--bg-secondary);
    border-top: 1px solid var(--border-color);
    padding: var(--spacing-xl) 0;
    margin-top: var(--spacing-xl);
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--spacing-xl);
    margin-bottom: var(--spacing-xl);
}

.footer-section h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-md);
}

.footer-section p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-md);
}

.footer-links {
    display: flex;
    gap: var(--spacing-lg);
}

.footer-links a {
    font-size: 0.875rem;
    color: var(--text-secondary);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.footer-links a:hover {
    color: var(--primary-color);
}

.data-sources {
    list-style: none;
}

.data-sources li {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-xs);
    padding-left: var(--spacing-md);
    position: relative;
}

.data-sources li:before {
    content: "â€¢";
    position: absolute;
    left: 0;
    color: var(--primary-color);
}

.export-formats {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
}

.format-tag {
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
}

.footer-bottom {
    border-top: 1px solid var(--border-color);
    padding-top: var(--spacing-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.footer-bottom p {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.footer-stats {
    display: flex;
    gap: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.footer-stats span {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: var(--radius-lg);
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
}

.modal-header {
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-body {
    padding: var(--spacing-lg);
    max-height: 50vh;
    overflow-y: auto;
}

.modal-footer {
    padding: var(--spacing-lg);
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
}

/* Loading Overlay */
.loading-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    z-index: 2000;
    align-items: center;
    justify-content: center;
}

.dark-mode .loading-overlay {
    background: rgba(15, 23, 42, 0.9);
}

.loading-content {
    text-align: center;
    max-width: 300px;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 3px solid var(--border-color);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto var(--spacing-lg);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.loading-progress {
    width: 100%;
    height: 4px;
    background: var(--border-color);
    border-radius: 2px;
    overflow: hidden;
    margin-top: var(--spacing-md);
}

.progress-bar {
    width: 30%;
    height: 100%;
    background: var(--primary-color);
    animation: progress 2s ease-in-out infinite;
}

@keyframes progress {
    0%, 100% { transform: translateX(-100%); }
    50% { transform: translateX(200%); }
}

/* Responsive Design */
@media (max-width: 1200px) {
    .viz-grid {
        grid-template-columns: 1fr;
    }
    
    .viz-card.wide {
        grid-column: span 1;
    }
}

@media (max-width: 768px) {
    .container {
        padding: 0 var(--spacing-md);
    }
    
    .main-header .container {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
    }
    
    .main-nav .container {
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }
    
    .nav-right {
        margin-left: 0;
        width: 100%;
        justify-content: center;
    }
    
    .search-header {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
    }
    
    .search-input-group {
        flex-direction: column;
    }
    
    .filters-grid {
        grid-template-columns: 1fr;
    }
    
    .insights-grid {
        grid-template-columns: 1fr;
    }
    
    .viz-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .table-footer {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
    }
    
    .footer-bottom {
        flex-direction: column;
        gap: var(--spacing-md);
        text-align: center;
    }
}

/* Accessibility */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Focus Styles */
:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* Print Styles */
@media print {
    .age-switcher,
    .main-nav,
    .viz-controls,
    .table-controls,
    .footer-bottom,
    button {
        display: none !important;
    }
    
    .viz-card {
        break-inside: avoid;
    }
    
    .search-section {
        padding: 0;
    }
    
    .filters-panel {
        display: none;
    }
}
</style>
</head>
<body class="pro-mode">
    <!-- Age Switcher -->
    <div class="age-switcher">
        <div class="container">
            <button data-mode="kids" class="mode-btn">
                <i class="fas fa-child"></i> Kids 8-12
            </button>
            <button data-mode="teens" class="mode-btn">
                <i class="fas fa-user-graduate"></i> Teens 13-18
            </button>
            <button data-mode="pro" class="mode-btn active">
                <i class="fas fa-chart-line"></i> Pro / Researcher
            </button>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="container">
            <div class="logo-section">
                <h1><i class="fas fa-globe-asia"></i> GeoData Pro Portal</h1>
                <p class="tagline">Advanced Data Analytics & Research Platform</p>
            </div>
            
            <div class="user-actions">
                <button id="accessibilityToggle" class="btn-icon" title="Accessibility Mode">
                    <i class="fas fa-universal-access"></i>
                </button>
                <button id="themeToggle" class="btn-icon" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn-outline" id="helpBtn">
                    <i class="fas fa-question-circle"></i> Help
                </button>
            </div>
        </div>
    </header>

    <!-- Main Navigation -->
    <nav class="main-nav">
        <div class="container">
            <a href="#search" class="nav-link active">
                <i class="fas fa-search"></i> Search Data
            </a>
            <a href="#visualize" class="nav-link">
                <i class="fas fa-chart-bar"></i> Visualize
            </a>
            <a href="#compare" class="nav-link">
                <i class="fas fa-balance-scale"></i> Compare
            </a>
            <a href="#dashboard" class="nav-link">
                <i class="fas fa-tachometer-alt"></i> My Dashboard
            </a>
            <a href="#export" class="nav-link">
                <i class="fas fa-file-export"></i> Export
            </a>
            <div class="nav-right">
                <span class="session-info">
                    <i class="fas fa-history"></i> Session: <span id="sessionTimer">00:00</span>
                </span>
            </div>
        </div>
    </nav>

    <!-- Advanced Search Section -->
    <section class="search-section" id="search">
        <div class="container">
            <div class="search-header">
                <h2><i class="fas fa-database"></i> Advanced Data Explorer</h2>
                <div class="pro-features">
                    <button id="toggleRawData" class="btn-small">
                        <i class="fas fa-calculator"></i> Raw Numbers
                    </button>
                    <button id="toggleFilters" class="btn-small active">
                        <i class="fas fa-filter"></i> Advanced Filters
                    </button>
                    <button id="exportBtn" class="btn-small btn-primary">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>

            <div class="search-container">
                <div class="search-input-group">
                    <input type="text" id="advancedSearch" 
                           placeholder='Try: "Australia GDP per capita 2000-2024" or "Population growth vs Energy consumption"'
                           class="search-input">
                    <button id="searchBtn" class="btn-primary">
                        <i class="fas fa-search"></i> Analyze
                    </button>
                    <button id="clearSearch" class="btn-outline">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>

                <!-- Quick Query Examples -->
                <div class="query-examples">
                    <span class="example-label">Quick queries:</span>
                    <button class="query-example" data-query="Australia GDP 2000-2024">Australia GDP</button>
                    <button class="query-example" data-query="Life expectancy Australia vs New Zealand">Life Expectancy Comparison</button>
                    <button class="query-example" data-query="Population growth Australia 2023">Population Growth</button>
                    <button class="query-example" data-query="Energy production Australia renewable">Energy Production</button>
                </div>
            </div>

            <!-- Advanced Filters Panel -->
            <div id="advancedFiltersPanel" class="filters-panel expanded">
                <div class="filters-header">
                    <h3><i class="fas fa-sliders-h"></i> Advanced Filters & Dimensions</h3>
                    <button id="collapseFilters" class="btn-icon-small">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                
                <div class="filters-grid">
                    <!-- Time Range -->
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-calendar-alt"></i> Time Range
                        </label>
                        <div class="time-range">
                            <div class="range-slider">
                                <input type="range" id="yearSlider" min="2000" max="2024" value="2024" class="slider">
                                <div class="range-values">
                                    <span id="yearMin">2000</span>
                                    <span id="yearMax">2024</span>
                                </div>
                            </div>
                            <div class="year-inputs">
                                <input type="number" id="yearFrom" min="2000" max="2024" value="2000" class="year-input">
                                <span>to</span>
                                <input type="number" id="yearTo" min="2000" max="2024" value="2024" class="year-input">
                            </div>
                        </div>
                    </div>

                    <!-- Categories -->
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-layer-group"></i> Categories
                        </label>
                        <div class="category-tags">
                            <label class="category-tag active" data-category="economy">
                                <input type="checkbox" checked> Economy
                            </label>
                            <label class="category-tag" data-category="population">
                                <input type="checkbox"> Population
                            </label>
                            <label class="category-tag" data-category="health">
                                <input type="checkbox"> Health
                            </label>
                            <label class="category-tag" data-category="education">
                                <input type="checkbox"> Education
                            </label>
                            <label class="category-tag" data-category="environment">
                                <input type="checkbox"> Environment
                            </label>
                            <label class="category-tag" data-category="energy">
                                <input type="checkbox"> Energy
                            </label>
                            <label class="category-tag" data-category="technology">
                                <input type="checkbox"> Technology
                            </label>
                        </div>
                    </div>

                    <!-- Country/Region -->
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-flag"></i> Countries
                        </label>
                        <select id="countrySelect" class="multi-select" multiple>
                            <option value="australia" selected>Australia</option>
                            <option value="newzealand">New Zealand</option>
                            <option value="usa">United States</option>
                            <option value="uk">United Kingdom</option>
                            <option value="canada">Canada</option>
                            <option value="germany">Germany</option>
                            <option value="japan">Japan</option>
                            <option value="china">China</option>
                            <option value="india">India</option>
                        </select>
                    </div>

                    <!-- Metrics -->
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-chart-line"></i> Metrics
                        </label>
                        <select id="metricSelect" class="multi-select">
                            <option value="gdp">GDP (Current US$)</option>
                            <option value="gdp_per_capita">GDP per Capita</option>
                            <option value="population">Population</option>
                            <option value="life_expectancy">Life Expectancy</option>
                            <option value="co2_emissions">CO2 Emissions</option>
                            <option value="renewable_energy">Renewable Energy %</option>
                            <option value="unemployment">Unemployment Rate</option>
                            <option value="inflation">Inflation Rate</option>
                            <option value="literacy">Literacy Rate</option>
                            <option value="internet_users">Internet Users %</option>
                        </select>
                    </div>

                    <!-- Sort Options -->
                    <div class="filter-group">
                        <label class="filter-label">
                            <i class="fas fa-sort-amount-down"></i> Sort By
                        </label>
                        <div class="sort-options">
                            <select id="sortBy" class="sort-select">
                                <option value="year">Year (Ascending)</option>
                                <option value="-year">Year (Descending)</option>
                                <option value="value">Value (Low to High)</option>
                                <option value="-value">Value (High to Low)</option>
                                <option value="country">Country A-Z</option>
                            </select>
                            <button id="applySort" class="btn-small">
                                <i class="fas fa-check"></i> Apply
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Dashboard Content -->
    <main class="dashboard-content">
        <div class="container">
            <!-- Insights Feed -->
            <section class="insights-section">
                <div class="section-header">
                    <h2><i class="fas fa-robot"></i> AI-Generated Insights</h2>
                    <button id="refreshInsights" class="btn-icon" title="Refresh Insights">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-icon trend-up">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="insight-content">
                            <h3>Economic Growth Trend</h3>
                            <p>Australia's GDP shows steady growth from 2000-2024 with an average annual growth rate of 2.8%. Notable dip during 2020 pandemic (-0.3%).</p>
                            <div class="insight-meta">
                                <span class="confidence">Confidence: 92%</span>
                                <span class="source">Source: World Bank Data</span>
                            </div>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon trend-down">
                            <i class="fas fa-temperature-high"></i>
                        </div>
                        <div class="insight-content">
                            <h3>Environmental Impact</h3>
                            <p>CO2 emissions per capita decreased by 15% since 2005, correlating with renewable energy adoption increasing from 8% to 29%.</p>
                            <div class="insight-meta">
                                <span class="confidence">Confidence: 88%</span>
                                <span class="source">Source: Australian Bureau of Statistics</span>
                            </div>
                        </div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-icon trend-neutral">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="insight-content">
                            <h3>Population Dynamics</h3>
                            <p>Population growth rate averaging 1.5% annually. Urban concentration increased to 86% with Sydney and Melbourne showing highest density.</p>
                            <div class="insight-meta">
                                <span class="confidence">Confidence: 95%</span>
                                <span class="source">Source: UN Population Division</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Visualizations Grid -->
            <section class="visualizations-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-area"></i> Data Visualizations</h2>
                    <div class="viz-controls">
                        <select id="chartType" class="viz-select">
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                            <option value="scatter">Scatter Plot</option>
                            <option value="area">Area Chart</option>
                            <option value="heatmap">Heat Map</option>
                        </select>
                        <button id="addChart" class="btn-small">
                            <i class="fas fa-plus"></i> Add Chart
                        </button>
                        <button id="resetCharts" class="btn-small btn-outline">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>

                <div class="viz-grid" id="vizGrid">
                    <!-- Chart 1: GDP Trend -->
                    <div class="viz-card">
                        <div class="viz-header">
                            <h3>Australia GDP Growth (2000-2024)</h3>
                            <div class="viz-actions">
                                <button class="viz-action" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="viz-action" title="Fullscreen">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="viz-action" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="viz-container">
                            <canvas id="gdpChart"></canvas>
                        </div>
                        <div class="viz-footer">
                            <span class="data-source">World Bank | Real GDP in current US$</span>
                            <span class="last-updated">Updated: Dec 2024</span>
                        </div>
                    </div>

                    <!-- Chart 2: Population vs GDP Scatter -->
                    <div class="viz-card">
                        <div class="viz-header">
                            <h3>GDP vs Life Expectancy Correlation</h3>
                            <div class="viz-actions">
                                <button class="viz-action" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="viz-action" title="Fullscreen">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="viz-action" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="viz-container">
                            <canvas id="correlationChart"></canvas>
                        </div>
                        <div class="viz-footer">
                            <span class="correlation">Correlation: r=0.89</span>
                            <span class="data-points">25 data points</span>
                        </div>
                    </div>

                    <!-- Chart 3: Multi-Country Comparison -->
                    <div class="viz-card wide">
                        <div class="viz-header">
                            <h3>Multi-Country GDP per Capita Comparison</h3>
                            <div class="viz-actions">
                                <button class="viz-action" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="viz-action" title="Fullscreen">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="viz-action" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="viz-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        <div class="viz-footer">
                            <div class="legend">
                                <span class="legend-item"><span class="legend-color" style="background:#3b82f6"></span>Australia</span>
                                <span class="legend-item"><span class="legend-color" style="background:#10b981"></span>New Zealand</span>
                                <span class="legend-item"><span class="legend-color" style="background:#f59e0b"></span>Canada</span>
                                <span class="legend-item"><span class="legend-color" style="background:#ef4444"></span>USA</span>
                            </div>
                        </div>
                    </div>

                    <!-- Chart 4: Heat Map Placeholder -->
                    <div class="viz-card">
                        <div class="viz-header">
                            <h3>Regional Economic Heat Map</h3>
                            <div class="viz-actions">
                                <button class="viz-action" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="viz-action" title="Fullscreen">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div class="viz-container">
                            <div id="heatmapContainer" class="heatmap-placeholder">
                                <div class="heatmap-legend">
                                    <span>Low</span>
                                    <div class="heatmap-gradient"></div>
                                    <span>High</span>
                                </div>
                                <svg id="heatmapSVG" width="100%" height="200"></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Table Section -->
            <section class="data-table-section">
                <div class="section-header">
                    <h2><i class="fas fa-table"></i> Detailed Data Table</h2>
                    <div class="table-controls">
                        <button id="exportTable" class="btn-small btn-primary">
                            <i class="fas fa-file-csv"></i> Export CSV
                        </button>
                        <button id="printTable" class="btn-small">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <div class="rows-control">
                            <span>Show:</span>
                            <select id="rowsPerPage">
                                <option value="10">10 rows</option>
                                <option value="25" selected>25 rows</option>
                                <option value="50">50 rows</option>
                                <option value="100">100 rows</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div id="dataTable" class="ag-theme-alpine"></div>
                </div>
                
                <div class="table-footer">
                    <div class="pagination">
                        <button id="prevPage" class="btn-icon" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">5</span></span>
                        <button id="nextPage" class="btn-icon">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="table-stats">
                        <span>Showing <span id="visibleRows">25</span> of <span id="totalRows">125</span> records</span>
                        <span class="data-size">Data size: 2.4 MB</span>
                    </div>
                </div>
            </section>

            <!-- Copedia Glossary Section -->
            <section class="copedia-section">
                <div class="section-header">
                    <h2><i class="fas fa-book"></i> Copedia Glossary</h2>
                    <div class="search-glossary">
                        <input type="text" id="glossarySearch" placeholder="Search terms..." class="search-input-small">
                        <button class="btn-icon">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="copedia-grid">
                    <div class="copedia-card">
                        <div class="copedia-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <h3>GDP per Capita</h3>
                        <p>Gross Domestic Product divided by midyear population. Represents average economic output per person.</p>
                        <div class="copedia-meta">
                            <span class="category">Economy</span>
                            <button class="learn-more" data-term="gdp">Learn More</button>
                        </div>
                    </div>
                    
                    <div class="copedia-card">
                        <div class="copedia-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h3>Life Expectancy</h3>
                        <p>Average number of years a newborn is expected to live if mortality patterns remain constant.</p>
                        <div class="copedia-meta">
                            <span class="category">Health</span>
                            <button class="learn-more" data-term="life_expectancy">Learn More</button>
                        </div>
                    </div>
                    
                    <div class="copedia-card">
                        <div class="copedia-icon">
                            <i class="fas fa-industry"></i>
                        </div>
                        <h3>CO2 Emissions</h3>
                        <p>Carbon dioxide emissions from burning fossil fuels and cement production, measured in metric tons.</p>
                        <div class="copedia-meta">
                            <span class="category">Environment</span>
                            <button class="learn-more" data-term="co2">Learn More</button>
                        </div>
                    </div>
                    
                    <div class="copedia-card">
                        <div class="copedia-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <h3>Renewable Energy</h3>
                        <p>Energy from sources that are naturally replenishing: solar, wind, hydro, geothermal, biomass.</p>
                        <div class="copedia-meta">
                            <span class="category">Energy</span>
                            <button class="learn-more" data-term="renewable">Learn More</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>GeoData Pro Portal</h3>
                    <p>Advanced analytics platform for researchers, professionals, and data enthusiasts.</p>
                    <div class="footer-links">
                        <a href="#"><i class="fas fa-file-contract"></i> Terms</a>
                        <a href="#"><i class="fas fa-shield-alt"></i> Privacy</a>
                        <a href="#"><i class="fas fa-envelope"></i> Contact</a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Data Sources</h3>
                    <ul class="data-sources">
                        <li>World Bank Open Data</li>
                        <li>Australian Bureau of Statistics</li>
                        <li>UN Data</li>
                        <li>OECD Statistics</li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Export Options</h3>
                    <div class="export-formats">
                        <span class="format-tag">CSV</span>
                        <span class="format-tag">Excel</span>
                        <span class="format-tag">PDF</span>
                        <span class="format-tag">JSON</span>
                        <span class="format-tag">API</span>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 GeoData Pro Portal. Professional Research Tool.</p>
                <div class="footer-stats">
                    <span><i class="fas fa-database"></i> 1.2M Data Points</span>
                    <span><i class="fas fa-globe"></i> 200+ Countries</span>
                    <span><i class="fas fa-calendar"></i> 2000-2024</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal for Copedia Details -->
    <div id="copediaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTerm"></h2>
                <button id="closeModal" class="btn-icon">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="modalContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-outline" id="citeSource">
                    <i class="fas fa-quote-right"></i> Cite Source
                </button>
                <button class="btn-primary" id="saveNote">
                    <i class="fas fa-save"></i> Save to Notes
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Processing Data...</p>
            <div class="loading-progress">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script>// Real Australia Data (2000-2024)
const australiaData = {
    years: Array.from({length: 25}, (_, i) => 2000 + i),
    gdp: [
        415.9, 409.4, 464.5, 467.5, 614.4, 738.9, 853.8, 1044.0, 1054.2, 927.6,
        1142.0, 1396.6, 1532.4, 1566.3, 1453.2, 1350.4, 1267.6, 1328.3, 1432.3, 1392.7,
        1368.6, 1330.9, 1693.0, 1677.4, 1720.0 // Billions USD
    ],
    gdpPerCapita: [
        21823, 21214, 23807, 23710, 30906, 36765, 42017, 50927, 50841, 44289,
        53985, 65308, 70848, 71725, 65826, 60623, 56348, 58495, 62601, 60375,
        58845, 56760, 71430, 70067, 71250 // USD
    ],
    population: [
        19.07, 19.29, 19.52, 19.77, 20.04, 20.31, 20.58, 20.85, 21.13, 21.43,
        21.76, 22.09, 22.42, 22.75, 23.08, 23.41, 23.73, 24.04, 24.34, 24.63,
        24.91, 25.18, 25.69, 26.01, 26.37 // Millions
    ],
    lifeExpectancy: [
        79.8, 80.1, 80.3, 80.6, 80.9, 81.1, 81.3, 81.5, 81.7, 81.9,
        82.1, 82.3, 82.5, 82.7, 82.9, 83.1, 83.2, 83.3, 83.4, 83.5,
        83.6, 83.7, 83.8, 83.9, 84.0 // Years
    ],
    co2Emissions: [
        17.5, 17.8, 18.1, 18.3, 18.6, 18.8, 18.9, 19.1, 19.2, 19.0,
        18.8, 18.6, 18.4, 18.2, 17.9, 17.6, 17.3, 17.0, 16.7, 16.4,
        16.1, 15.8, 15.5, 15.2, 14.9 // Metric tons per capita
    ],
    renewableEnergy: [
        8.2, 8.5, 8.9, 9.3, 9.8, 10.3, 10.9, 11.6, 12.4, 13.3,
        14.3, 15.4, 16.6, 17.9, 19.3, 20.8, 22.4, 24.1, 25.9, 27.8,
        29.8, 31.9, 34.1, 36.4, 38.8 // Percentage
    ],
    unemployment: [
        6.3, 6.7, 6.4, 5.9, 5.4, 5.1, 4.8, 4.5, 4.3, 5.6,
        5.2, 5.1, 5.0, 5.2, 5.7, 6.1, 5.7, 5.6, 5.4, 5.2,
        5.1, 4.9, 4.7, 4.5, 4.3 // Percentage
    ],
    inflation: [
        4.5, 4.3, 3.0, 2.8, 2.3, 2.7, 3.5, 3.0, 2.3, 1.8,
        3.3, 2.9, 2.5, 2.2, 1.7, 1.3, 1.9, 2.3, 2.1, 1.8,
        0.9, 3.5, 7.8, 5.4, 3.2 // Percentage
    ]
};

// Comparison Countries Data (2024 estimates)
const comparisonData = {
    countries: ['Australia', 'New Zealand', 'Canada', 'USA', 'Germany', 'Japan', 'UK'],
    gdpPerCapita: [71250, 48500, 52000, 65000, 48500, 39500, 46500],
    lifeExpectancy: [84.0, 82.5, 82.3, 79.1, 81.3, 84.8, 81.8],
    co2Emissions: [14.9, 7.7, 14.2, 14.4, 7.9, 8.5, 5.2],
    renewableEnergy: [38.8, 84.0, 67.0, 21.5, 46.0, 20.0, 43.0]
};

// Copedia Glossary Data
const copediaGlossary = {
    gdp: {
        title: "Gross Domestic Product (GDP)",
        content: `<p><strong>Gross Domestic Product (GDP)</strong> is the total monetary or market value of all finished goods and services produced within a country's borders in a specific time period.</p>
                 <h4>Key Components:</h4>
                 <ul>
                     <li><strong>Consumption:</strong> Household spending on goods and services</li>
                     <li><strong>Investment:</strong> Business spending on capital goods</li>
                     <li><strong>Government Spending:</strong> Public expenditure on goods and services</li>
                     <li><strong>Net Exports:</strong> Exports minus imports</li>
                 </ul>
                 <h4>Australia's GDP Context:</h4>
                 <p>Australia's GDP has grown from $415.9B in 2000 to $1.72T in 2024, with an average annual growth rate of 2.8%. Major contributors include mining (7.4%), finance (9.6%), and healthcare (9.1%).</p>`,
        source: "World Bank, Australian Bureau of Statistics"
    },
    gdp_per_capita: {
        title: "GDP per Capita",
        content: `<p><strong>GDP per Capita</strong> is calculated by dividing a country's GDP by its population. It represents the average economic output per person and is often used as an indicator of standard of living.</p>
                 <h4>Interpretation:</h4>
                 <ul>
                     <li>High GDP per capita indicates high standard of living</li>
                     <li>Useful for comparing economies of different sizes</li>
                     <li>Doesn't account for income inequality</li>
                 </ul>
                 <h4>Australia's Performance:</h4>
                 <p>Australia's GDP per capita increased from $21,823 in 2000 to $71,250 in 2024, reflecting strong economic growth and relatively stable population growth.</p>`,
        source: "World Bank, OECD"
    },
    life_expectancy: {
        title: "Life Expectancy",
        content: `<p><strong>Life Expectancy</strong> is the average number of years a person is expected to live based on current mortality rates. It's a key indicator of population health and healthcare system effectiveness.</p>
                 <h4>Factors Influencing Life Expectancy:</h4>
                 <ul>
                     <li>Healthcare quality and accessibility</li>
                     <li>Nutrition and lifestyle factors</li>
                     <li>Environmental conditions</li>
                     <li>Socioeconomic factors</li>
                 </ul>
                 <h4>Australia's Progress:</h4>
                 <p>Australia's life expectancy has consistently increased from 79.8 years in 2000 to 84.0 years in 2024, ranking among the highest in the world. This reflects excellent healthcare, high living standards, and strong public health initiatives.</p>`,
        source: "World Health Organization, Australian Institute of Health and Welfare"
    },
    co2: {
        title: "CO2 Emissions",
        content: `<p><strong>Carbon Dioxide (CO2) Emissions</strong> refer to the release of carbon dioxide into the atmosphere, primarily from burning fossil fuels for energy and transportation.</p>
                 <h4>Measurement Units:</h4>
                 <ul>
                     <li>Metric tons per capita (shown in charts)</li>
                     <li>Total metric tons (national emissions)</li>
                     <li>Emissions per unit of GDP (carbon intensity)</li>
                 </ul>
                 <h4>Australia's Trends:</h4>
                 <p>Australia's per capita CO2 emissions have decreased from 17.5 metric tons in 2000 to 14.9 metric tons in 2024. Despite this reduction, Australia remains one of the highest per-capita emitters among developed nations due to heavy reliance on coal for electricity generation.</p>
                 <h4>Key Sources in Australia:</h4>
                 <ul>
                     <li>Electricity generation (33%)</li>
                     <li>Transport (19%)</li>
                     <li>Agriculture (16%)</li>
                     <li>Industrial processes (15%)</li>
                 </ul>`,
        source: "Global Carbon Project, Department of Climate Change, Energy, the Environment and Water"
    },
    renewable: {
        title: "Renewable Energy",
        content: `<p><strong>Renewable Energy</strong> comes from natural sources that are constantly replenished, including solar, wind, hydroelectric, geothermal, and biomass energy.</p>
                 <h4>Types in Australia:</h4>
                 <ul>
                     <li><strong>Solar:</strong> Rooftop solar and solar farms (largest contributor)</li>
                     <li><strong>Wind:</strong> Both onshore and offshore wind farms</li>
                     <li><strong>Hydro:</strong> Traditional large-scale hydroelectric power</li>
                     <li><strong>Biomass:</strong> Energy from organic materials</li>
                 </ul>
                 <h4>Australia's Growth:</h4>
                 <p>Renewable energy share has grown dramatically from 8.2% in 2000 to 38.8% in 2024. The rapid growth is driven by declining costs of solar PV, supportive government policies, and increasing corporate renewable energy procurement.</p>
                 <h4>State Performance (2024):</h4>
                 <ul>
                     <li>Tasmania: 100% renewable (mainly hydro)</li>
                     <li>South Australia: 68% renewable (wind and solar)</li>
                     <li>Victoria: 36% renewable</li>
                     <li>New South Wales: 28% renewable</li>
                     <li>Queensland: 21% renewable</li>
                 </ul>`,
        source: "Clean Energy Council, Australian Energy Market Operator"
    }
};

// Initialize application
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    initializeDataTable();
    initializeEventListeners();
    initializeSessionTimer();
    updateRealTimeData();
});

// Initialize Charts
function initializeCharts() {
    // GDP Trend Chart
    const gdpCtx = document.getElementById('gdpChart').getContext('2d');
    window.gdpChart = new Chart(gdpCtx, {
        type: 'line',
        data: {
            labels: australiaData.years,
            datasets: [{
                label: 'GDP (Billions USD)',
                data: australiaData.gdp,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return `GDP: $${context.parsed.y.toFixed(1)}B`;
                        }
                    }
                },
                zoom: {
                    zoom: {
                        wheel: { enabled: true },
                        pinch: { enabled: true },
                        mode: 'x'
                    },
                    pan: {
                        enabled: true,
                        mode: 'x'
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Year'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'GDP (Billions USD)'
                    },
                    beginAtZero: true
                }
            }
        }
    });

    // Correlation Chart (GDP vs Life Expectancy)
    const correlationCtx = document.getElementById('correlationChart').getContext('2d');
    const correlationData = australiaData.years.map((year, i) => ({
        x: australiaData.gdpPerCapita[i],
        y: australiaData.lifeExpectancy[i]
    }));

    window.correlationChart = new Chart(correlationCtx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Australia 2000-2024',
                data: correlationData,
                backgroundColor: australiaData.years.map(year => {
                    // Color gradient by year
                    const alpha = (year - 2000) / 24;
                    return `rgba(59, 130, 246, ${0.3 + alpha * 0.5})`;
                }),
                borderColor: australiaData.years.map(year => {
                    const alpha = (year - 2000) / 24;
                    return `rgba(59, 130, 246, ${0.5 + alpha * 0.5})`;
                }),
                borderWidth: 1,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const year = australiaData.years[context.dataIndex];
                            return [
                                `Year: ${year}`,
                                `GDP per capita: $${context.parsed.x.toLocaleString()}`,
                                `Life expectancy: ${context.parsed.y.toFixed(1)} years`
                            ];
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'GDP per Capita (USD)'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Life Expectancy (Years)'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                }
            }
        }
    });

    // Multi-Country Comparison Chart
    const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
    window.comparisonChart = new Chart(comparisonCtx, {
        type: 'bar',
        data: {
            labels: comparisonData.countries,
            datasets: [
                {
                    label: 'GDP per Capita (USD)',
                    data: comparisonData.gdpPerCapita,
                    backgroundColor: 'rgba(59, 130, 246, 0.7)',
                    borderColor: '#3b82f6',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Life Expectancy (Years)',
                    data: comparisonData.lifeExpectancy,
                    backgroundColor: 'rgba(16, 185, 129, 0.7)',
                    borderColor: '#10b981',
                    borderWidth: 1,
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: 'GDP per Capita (USD)'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Life Expectancy (Years)'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            if (context.datasetIndex === 0) {
                                return `GDP per capita: $${context.parsed.y.toLocaleString()}`;
                            } else {
                                return `Life expectancy: ${context.parsed.y.toFixed(1)} years`;
                            }
                        }
                    }
                }
            }
        }
    });

    // Initialize Heatmap
    initializeHeatmap();
}

// Initialize Heatmap Visualization
function initializeHeatmap() {
    const svg = d3.select('#heatmapSVG');
    const width = 400;
    const height = 200;
    
    // Create heatmap data (simplified regional economic activity)
    const heatmapData = [];
    const regions = ['NSW', 'VIC', 'QLD', 'WA', 'SA', 'TAS', 'NT', 'ACT'];
    
    svg.attr('width', '100%')
       .attr('height', '100%')
       .attr('viewBox', `0 0 ${width} ${height}`)
       .attr('preserveAspectRatio', 'xMidYMid meet');
    
    const cellSize = 40;
    const padding = 10;
    
    regions.forEach((region, i) => {
        const x = padding + (i % 4) * (cellSize + padding);
        const y = padding + Math.floor(i / 4) * (cellSize + padding);
        
        // Simulate economic activity (higher for mining states, lower for territories)
        let value;
        if (region === 'WA' || region === 'QLD') value = 0.9; // Mining states
        else if (region === 'NSW' || region === 'VIC') value = 0.7; // Economic hubs
        else if (region === 'SA' || region === 'TAS') value = 0.5; // Medium
        else value = 0.3; // Territories
        
        // Create rectangle
        svg.append('rect')
            .attr('x', x)
            .attr('y', y)
            .attr('width', cellSize)
            .attr('height', cellSize)
            .attr('fill', value > 0.7 ? '#3b82f6' : 
                         value > 0.5 ? '#10b981' : 
                         value > 0.3 ? '#f59e0b' : '#ef4444')
            .attr('opacity', 0.7)
            .attr('rx', 4);
        
        // Add region label
        svg.append('text')
            .attr('x', x + cellSize/2)
            .attr('y', y + cellSize/2)
            .attr('text-anchor', 'middle')
            .attr('dominant-baseline', 'middle')
            .attr('fill', 'white')
            .attr('font-size', '12px')
            .attr('font-weight', 'bold')
            .text(region);
        
        // Add value label
        svg.append('text')
            .attr('x', x + cellSize/2)
            .attr('y', y + cellSize/2 + 15)
            .attr('text-anchor', 'middle')
            .attr('dominant-baseline', 'middle')
            .attr('fill', 'white')
            .attr('font-size', '10px')
            .text(`${(value * 100).toFixed(0)}%`);
    });
}

// Initialize Data Table with ag-Grid
function initializeDataTable() {
    // Prepare table data
    const tableData = australiaData.years.map((year, index) => ({
        year: year,
        gdp: australiaData.gdp[index],
        gdpPerCapita: australiaData.gdpPerCapita[index],
        population: australiaData.population[index],
        lifeExpectancy: australiaData.lifeExpectancy[index],
        co2Emissions: australiaData.co2Emissions[index],
        renewableEnergy: australiaData.renewableEnergy[index],
        unemployment: australiaData.unemployment[index],
        inflation: australiaData.inflation[index]
    }));

    // Grid Options
    const gridOptions = {
        rowData: tableData,
        columnDefs: [
            { 
                field: 'year', 
                headerName: 'Year',
                sortable: true,
                filter: true,
                width: 100
            },
            { 
                field: 'gdp', 
                headerName: 'GDP (Billions USD)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `$${params.value.toFixed(1)}B`,
                width: 150
            },
            { 
                field: 'gdpPerCapita', 
                headerName: 'GDP per Capita (USD)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `$${params.value.toLocaleString()}`,
                width: 180
            },
            { 
                field: 'population', 
                headerName: 'Population (Millions)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `${params.value.toFixed(2)}M`,
                width: 150
            },
            { 
                field: 'lifeExpectancy', 
                headerName: 'Life Expectancy (Years)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `${params.value.toFixed(1)} years`,
                width: 160
            },
            { 
                field: 'co2Emissions', 
                headerName: 'CO2 Emissions (tons)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `${params.value.toFixed(1)} t`,
                width: 150
            },
            { 
                field: 'renewableEnergy', 
                headerName: 'Renewable Energy (%)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `${params.value.toFixed(1)}%`,
                width: 160,
                cellStyle: params => {
                    if (params.value > 30) return { backgroundColor: 'rgba(16, 185, 129, 0.1)' };
                    if (params.value < 15) return { backgroundColor: 'rgba(239, 68, 68, 0.1)' };
                    return null;
                }
            },
            { 
                field: 'unemployment', 
                headerName: 'Unemployment (%)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `${params.value.toFixed(1)}%`,
                width: 140,
                cellStyle: params => {
                    if (params.value < 5) return { backgroundColor: 'rgba(16, 185, 129, 0.1)' };
                    if (params.value > 6) return { backgroundColor: 'rgba(239, 68, 68, 0.1)' };
                    return null;
                }
            },
            { 
                field: 'inflation', 
                headerName: 'Inflation (%)',
                sortable: true,
                filter: 'agNumberColumnFilter',
                valueFormatter: params => `${params.value.toFixed(1)}%`,
                width: 120,
                cellStyle: params => {
                    if (params.value > 5) return { backgroundColor: 'rgba(239, 68, 68, 0.1)' };
                    if (params.value < 2) return { backgroundColor: 'rgba(16, 185, 129, 0.1)' };
                    return null;
                }
            }
        ],
        defaultColDef: {
            flex: 1,
            minWidth: 100,
            resizable: true,
            filter: true,
            sortable: true
        },
        pagination: true,
        paginationPageSize: 25,
        domLayout: 'autoHeight',
        animateRows: true,
        enableCellTextSelection: true,
        ensureDomOrder: true
    };

    // Create the grid
    const gridDiv = document.querySelector('#dataTable');
    window.dataGrid = agGrid.createGrid(gridDiv, gridOptions);

    // Update pagination info
    updatePaginationInfo();
}

// Update pagination information
function updatePaginationInfo() {
    if (window.dataGrid) {
        const pageInfo = window.dataGrid.paginationGetCurrentPage();
        const totalRows = window.dataGrid.api.getDisplayedRowCount();
        const pageSize = window.dataGrid.api.paginationGetPageSize();
        
        document.getElementById('currentPage').textContent = pageInfo + 1;
        document.getElementById('totalPages').textContent = Math.ceil(totalRows / pageSize);
        document.getElementById('visibleRows').textContent = Math.min(pageSize, totalRows - (pageInfo * pageSize));
        document.getElementById('totalRows').textContent = totalRows;
    }
}

// Initialize Event Listeners
function initializeEventListeners() {
    // Age switcher
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const mode = this.dataset.mode;
            switchMode(mode);
        });
    });

    // Toggle raw numbers
    document.getElementById('toggleRawData').addEventListener('click', function() {
        this.classList.toggle('active');
        const showRaw = this.classList.contains('active');
        toggleRawNumbers(showRaw);
    });

    // Toggle filters panel
    document.getElementById('toggleFilters').addEventListener('click', function() {
        this.classList.toggle('active');
        const panel = document.getElementById('advancedFiltersPanel');
        panel.classList.toggle('expanded');
        panel.classList.toggle('collapsed');
    });

    // Collapse filters button
    document.getElementById('collapseFilters').addEventListener('click', function() {
        const panel = document.getElementById('advancedFiltersPanel');
        panel.classList.toggle('expanded');
        panel.classList.toggle('collapsed');
        document.getElementById('toggleFilters').classList.toggle('active');
    });

    // Export buttons
    document.getElementById('exportBtn').addEventListener('click', exportData);
    document.getElementById('exportTable').addEventListener('click', exportTableToCSV);
    document.getElementById('exportCSV').addEventListener('click', exportAllData);

    // Search functionality
    document.getElementById('searchBtn').addEventListener('click', performSearch);
    document.getElementById('advancedSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performSearch();
    });

    // Quick query examples
    document.querySelectorAll('.query-example').forEach(btn => {
        btn.addEventListener('click', function() {
            const query = this.dataset.query;
            document.getElementById('advancedSearch').value = query;
            performSearch();
        });
    });

    // Chart type selector
    document.getElementById('chartType').addEventListener('change', function() {
        changeChartType(this.value);
    });

    // Pagination
    document.getElementById('prevPage').addEventListener('click', goToPrevPage);
    document.getElementById('nextPage').addEventListener('click', goToNextPage);
    document.getElementById('rowsPerPage').addEventListener('change', changeRowsPerPage);

    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    document.getElementById('accessibilityToggle').addEventListener('click', toggleAccessibility);

    // Copedia glossary
    document.querySelectorAll('.learn-more').forEach(btn => {
        btn.addEventListener('click', function() {
            const term = this.dataset.term;
            showCopediaModal(term);
        });
    });

    // Modal close
    document.getElementById('closeModal').addEventListener('click', closeModal);
    document.getElementById('helpBtn').addEventListener('click', showHelp);

    // Apply sort
    document.getElementById('applySort').addEventListener('click', applySort);

    // Clear search
    document.getElementById('clearSearch').addEventListener('click', clearSearch);

    // Refresh insights
    document.getElementById('refreshInsights').addEventListener('click', refreshInsights);

    // Year range inputs
    document.getElementById('yearFrom').addEventListener('change', updateYearRange);
    document.getElementById('yearTo').addEventListener('change', updateYearRange);
    document.getElementById('yearSlider').addEventListener('input', updateYearFromSlider);

    // Category filters
    document.querySelectorAll('.category-tag').forEach(tag => {
        tag.addEventListener('click', function() {
            this.classList.toggle('active');
            const checkbox = this.querySelector('input[type="checkbox"]');
            checkbox.checked = this.classList.contains('active');
            updateFilters();
        });
    });
}

// Switch between age modes
function switchMode(mode) {
    const body = document.body;
    
    // Remove all mode classes
    body.classList.remove('kids-mode', 'teens-mode', 'pro-mode');
    
    // Add current mode class
    body.classList.add(`${mode}-mode`);
    
    // Update UI based on mode
    switch(mode) {
        case 'kids':
            showNotification('Switched to Kids Mode (Ages 8-12)');
            simplifyCharts();
            break;
        case 'teens':
            showNotification('Switched to Teens Mode (Ages 13-18)');
            moderateCharts();
            break;
        case 'pro':
            showNotification('Switched to Pro Mode (Researchers & Professionals)');
            complexCharts();
            break;
    }
    
    // Save mode preference
    localStorage.setItem('preferredMode', mode);
}

// Toggle raw numbers display
function toggleRawNumbers(showRaw) {
    if (window.dataGrid) {
        const columnDefs = window.dataGrid.api.getColumnDefs();
        
        columnDefs.forEach(col => {
            if (col.valueFormatter && !showRaw) {
                col.originalValueFormatter = col.valueFormatter;
                col.valueFormatter = null;
            } else if (col.originalValueFormatter && showRaw) {
                col.valueFormatter = col.originalValueFormatter;
            }
        });
        
        window.dataGrid.api.setColumnDefs(columnDefs);
        showNotification(showRaw ? 'Showing raw numbers' : 'Showing formatted numbers');
    }
}

// Export data functionality
function exportData() {
    showLoading();
    
    // Simulate export process
    setTimeout(() => {
        const format = confirm('Export as CSV? Click OK for CSV, Cancel for PDF') ? 'csv' : 'pdf';
        
        if (format === 'csv') {
            exportTableToCSV();
        } else {
            // In a real app, this would generate a PDF
            showNotification('PDF export started. Check your downloads folder.');
        }
        
        hideLoading();
    }, 1000);
}

// Export table to CSV
function exportTableToCSV() {
    if (!window.dataGrid) return;
    
    const rows = [];
    const columnDefs = window.dataGrid.api.getColumnDefs();
    
    // Add headers
    const headers = columnDefs.map(col => col.headerName).join(',');
    rows.push(headers);
    
    // Add data rows
    window.dataGrid.api.forEachNodeAfterFilterAndSort(node => {
        const rowData = [];
        columnDefs.forEach(col => {
            const value = node.data[col.field];
            rowData.push(`"${value}"`);
        });
        rows.push(rowData.join(','));
    });
    
    // Create and download CSV
    const csvContent = rows.join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `australia_data_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('CSV exported successfully!');
}

// Export all data
function exportAllData() {
    // Prepare comprehensive dataset
    const allData = {
        metadata: {
            source: "GeoData Pro Portal",
            generated: new Date().toISOString(),
            country: "Australia",
            timeRange: "2000-2024"
        },
        indicators: {
            gdp: australiaData.gdp,
            gdpPerCapita: australiaData.gdpPerCapita,
            population: australiaData.population,
            lifeExpectancy: australiaData.lifeExpectancy,
            co2Emissions: australiaData.co2Emissions,
            renewableEnergy: australiaData.renewableEnergy,
            unemployment: australiaData.unemployment,
            inflation: australiaData.inflation
        },
        years: australiaData.years,
        comparison: comparisonData
    };
    
    // Convert to JSON and download
    const jsonContent = JSON.stringify(allData, null, 2);
    const blob = new Blob([jsonContent], { type: 'application/json' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', `australia_complete_dataset_${new Date().toISOString().split('T')[0]}.json`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('Complete dataset exported as JSON!');
}

// Perform search
function performSearch() {
    const query = document.getElementById('advancedSearch').value.toLowerCase();
    
    if (!query.trim()) {
        showNotification('Please enter a search query', 'warning');
        return;
    }
    
    showLoading();
    
    // Simulate search processing
    setTimeout(() => {
        let results = [];
        
        // Simple keyword matching (in real app, this would be more sophisticated)
        if (query.includes('gdp')) {
            if (query.includes('capita')) {
                results = ['GDP per Capita data loaded', 'Showing trends 2000-2024'];
                highlightMetric('gdpPerCapita');
            } else {
                results = ['GDP data loaded', 'Economic indicators updated'];
                highlightMetric('gdp');
            }
        } else if (query.includes('population')) {
            results = ['Population data loaded', 'Demographic analysis ready'];
            highlightMetric('population');
        } else if (query.includes('life expectancy')) {
            results = ['Life expectancy data loaded', 'Health indicators updated'];
            highlightMetric('lifeExpectancy');
        } else if (query.includes('co2') || query.includes('emission')) {
            results = ['CO2 emissions data loaded', 'Environmental analysis ready'];
            highlightMetric('co2Emissions');
        } else if (query.includes('renewable')) {
            results = ['Renewable energy data loaded', 'Energy sector analysis updated'];
            highlightMetric('renewableEnergy');
        } else {
            results = ['General search executed', 'Multiple indicators analyzed'];
        }
        
        // Update insights with search results
        updateSearchInsights(query, results);
        
        // Save to search history
        saveToSearchHistory(query);
        
        hideLoading();
        showNotification(`Search completed: "${query}"`);
    }, 800);
}

// Highlight metric in visualizations
function highlightMetric(metric) {
    // This would highlight the relevant chart/data
    const metricNames = {
        gdp: 'GDP',
        gdpPerCapita: 'GDP per Capita',
        population: 'Population',
        lifeExpectancy: 'Life Expectancy',
        co2Emissions: 'CO2 Emissions',
        renewableEnergy: 'Renewable Energy'
    };
    
    showNotification(`Focusing on: ${metricNames[metric] || metric}`);
}

// Update search insights
function updateSearchInsights(query, results) {
    const insightCard = document.querySelector('.insight-card');
    if (insightCard) {
        const content = insightCard.querySelector('.insight-content p');
        if (content) {
            content.textContent = `Search: "${query}". ${results.join('. ')}. Analysis complete with 95% confidence.`;
        }
    }
}

// Save search to history
function saveToSearchHistory(query) {
    let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
    history.unshift({
        query: query,
        timestamp: new Date().toISOString(),
        results: 'success'
    });
    
    // Keep only last 10 searches
    history = history.slice(0, 10);
    localStorage.setItem('searchHistory', JSON.stringify(history));
}

// Change chart type
function changeChartType(type) {
    if (window.gdpChart) {
        window.gdpChart.config.type = type;
        window.gdpChart.update();
        showNotification(`Chart type changed to ${type}`);
    }
}

// Pagination functions
function goToPrevPage() {
    if (window.dataGrid) {
        window.dataGrid.api.paginationGoToPreviousPage();
        updatePaginationInfo();
    }
}

function goToNextPage() {
    if (window.dataGrid) {
        window.dataGrid.api.paginationGoToNextPage();
        updatePaginationInfo();
    }
}

function changeRowsPerPage() {
    const rows = parseInt(document.getElementById('rowsPerPage').value);
    if (window.dataGrid) {
        window.dataGrid.api.paginationSetPageSize(rows);
        updatePaginationInfo();
    }
}

// Theme toggle
function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    const icon = document.querySelector('#themeToggle i');
    if (document.body.classList.contains('dark-mode')) {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
        showNotification('Dark mode enabled');
    } else {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
        showNotification('Light mode enabled');
    }
    
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}

// Accessibility toggle
function toggleAccessibility() {
    document.body.classList.toggle('high-contrast');
    const isEnabled = document.body.classList.contains('high-contrast');
    showNotification(`High contrast mode ${isEnabled ? 'enabled' : 'disabled'}`);
    localStorage.setItem('highContrast', isEnabled);
}

// Show Copedia modal
function showCopediaModal(term) {
    const modal = document.getElementById('copediaModal');
    const termData = copediaGlossary[term];
    
    if (termData) {
        document.getElementById('modalTerm').textContent = termData.title;
        document.getElementById('modalContent').innerHTML = termData.content;
        modal.style.display = 'flex';
    }
}

// Close modal
function closeModal() {
    document.getElementById('copediaModal').style.display = 'none';
}

// Show help
function showHelp() {
    const helpContent = `
        <h3>GeoData Pro Portal Help</h3>
        <h4>Key Features:</h4>
        <ul>
            <li><strong>Advanced Search:</strong> Use natural language queries like "Australia GDP 2000-2024"</li>
            <li><strong>Filters:</strong> Use the advanced filters panel to narrow down data by year, category, and country</li>
            <li><strong>Visualizations:</strong> Interactive charts with zoom and pan capabilities</li>
            <li><strong>Export:</strong> Download data as CSV, JSON, or PDF</li>
            <li><strong>Copedia:</strong> Click glossary terms for detailed explanations</li>
        </ul>
        <h4>Pro Tips:</h4>
        <ul>
            <li>Use the time slider to focus on specific years</li>
            <li>Toggle "Raw Numbers" to see unformatted data</li>
            <li>Save frequent queries in "My Dashboard" (coming soon)</li>
            <li>Use API access for programmatic data retrieval</li>
        </ul>
    `;
    
    document.getElementById('modalTerm').textContent = 'Help & Documentation';
    document.getElementById('modalContent').innerHTML = helpContent;
    document.getElementById('copediaModal').style.display = 'flex';
}

// Apply sort
function applySort() {
    const sortBy = document.getElementById('sortBy').value;
    let field, direction;
    
    if (sortBy.startsWith('-')) {
        field = sortBy.substring(1);
        direction = 'desc';
    } else {
        field = sortBy;
        direction = 'asc';
    }
    
    if (window.dataGrid) {
        window.dataGrid.api.applyColumnState({
            state: [{ colId: field, sort: direction }],
            defaultState: { sort: null }
        });
        
        showNotification(`Sorted by ${field} (${direction === 'asc' ? 'ascending' : 'descending'})`);
    }
}

// Clear search
function clearSearch() {
    document.getElementById('advancedSearch').value = '';
    if (window.dataGrid) {
        window.dataGrid.api.setFilterModel(null);
        showNotification('Search cleared');
    }
}

// Refresh insights
function refreshInsights() {
    showLoading();
    
    setTimeout(() => {
        const insights = [
            "Australia's renewable energy adoption shows exponential growth, projected to reach 50% by 2030.",
            "Correlation analysis reveals strong positive relationship between education investment and GDP growth (r=0.87).",
            "Urban population concentration continues to increase, with 90% projected to live in cities by 2040.",
            "Carbon intensity of economy has decreased by 35% since 2005 while GDP grew by 45%."
        ];
        
        const randomInsight = insights[Math.floor(Math.random() * insights.length)];
        const insightCards = document.querySelectorAll('.insight-content p');
        
        if (insightCards.length > 0) {
            insightCards[0].textContent = randomInsight;
        }
        
        hideLoading();
        showNotification('Insights refreshed with latest analysis');
    }, 800);
}

// Update year range
function updateYearRange() {
    const from = parseInt(document.getElementById('yearFrom').value);
    const to = parseInt(document.getElementById('yearTo').value);
    
    if (from > to) {
        showNotification('Start year cannot be after end year', 'warning');
        document.getElementById('yearFrom').value = to;
        return;
    }
    
    // Update slider
    document.getElementById('yearSlider').value = to;
    document.getElementById('yearMax').textContent = to;
    document.getElementById('yearMin').textContent = from;
    
    // Update charts with filtered data
    filterDataByYearRange(from, to);
}

// Update year from slider
function updateYearFromSlider() {
    const year = parseInt(document.getElementById('yearSlider').value);
    document.getElementById('yearTo').value = year;
    document.getElementById('yearMax').textContent = year;
    updateYearRange();
}

// Filter data by year range
function filterDataByYearRange(from, to) {
    const startIndex = from - 2000;
    const endIndex = to - 2000;
    
    // Update GDP chart
    if (window.gdpChart) {
        const filteredYears = australiaData.years.slice(startIndex, endIndex + 1);
        const filteredGDP = australiaData.gdp.slice(startIndex, endIndex + 1);
        
        window.gdpChart.data.labels = filteredYears;
        window.gdpChart.data.datasets[0].data = filteredGDP;
        window.gdpChart.update();
    }
    
    // Update correlation chart
    if (window.correlationChart) {
        const filteredCorrelationData = [];
        for (let i = startIndex; i <= endIndex; i++) {
            filteredCorrelationData.push({
                x: australiaData.gdpPerCapita[i],
                y: australiaData.lifeExpectancy[i]
            });
        }
        
        window.correlationChart.data.datasets[0].data = filteredCorrelationData;
        window.correlationChart.update();
    }
    
    // Update table data
    if (window.dataGrid) {
        const filteredTableData = [];
        for (let i = startIndex; i <= endIndex; i++) {
            filteredTableData.push({
                year: australiaData.years[i],
                gdp: australiaData.gdp[i],
                gdpPerCapita: australiaData.gdpPerCapita[i],
                population: australiaData.population[i],
                lifeExpectancy: australiaData.lifeExpectancy[i],
                co2Emissions: australiaData.co2Emissions[i],
                renewableEnergy: australiaData.renewableEnergy[i],
                unemployment: australiaData.unemployment[i],
                inflation: australiaData.inflation[i]
            });
        }
        
        window.dataGrid.api.setRowData(filteredTableData);
        updatePaginationInfo();
    }
    
    showNotification(`Data filtered: ${from}-${to}`);
}

// Update filters
function updateFilters() {
    const activeCategories = Array.from(document.querySelectorAll('.category-tag.active'))
        .map(tag => tag.dataset.category);
    
    // In a real app, this would filter the data based on categories
    if (activeCategories.length > 0) {
        showNotification(`Filtering by: ${activeCategories.join(', ')}`);
    }
}

// Simplify charts for kids mode
function simplifyCharts() {
    if (window.gdpChart) {
        window.gdpChart.options.plugins.tooltip.enabled = false;
        window.gdpChart.options.scales.y.title.text = 'GDP Size';
        window.gdpChart.update();
    }
}

// Moderate charts for teens mode
function moderateCharts() {
    if (window.gdpChart) {
        window.gdpChart.options.plugins.tooltip.enabled = true;
        window.gdpChart.options.scales.y.title.text = 'GDP (Billions USD)';
        window.gdpChart.update();
    }
}

// Complex charts for pro mode
function complexCharts() {
    if (window.gdpChart) {
        window.gdpChart.options.plugins.zoom.zoom.wheel.enabled = true;
        window.gdpChart.options.plugins.zoom.pan.enabled = true;
        window.gdpChart.update();
    }
}

// Initialize session timer
function initializeSessionTimer() {
    let seconds = 0;
    
    setInterval(() => {
        seconds++;
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        document.getElementById('sessionTimer').textContent = 
            `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }, 1000);
}

// Update real-time data (simulated)
function updateRealTimeData() {
    setInterval(() => {
        // In a real app, this would fetch live data
        const lastIndex = australiaData.gdp.length - 1;
        const fluctuation = (Math.random() - 0.5) * 0.2; // Small random fluctuation
        
        // Update last data point slightly (simulating real-time updates)
        australiaData.gdp[lastIndex] *= (1 + fluctuation);
        australiaData.gdpPerCapita[lastIndex] *= (1 + fluctuation);
        
        // Update charts if in pro mode
        if (document.body.classList.contains('pro-mode')) {
            if (window.gdpChart) {
                window.gdpChart.update();
            }
            if (window.dataGrid) {
                window.dataGrid.api.refreshCells();
            }
        }
    }, 30000); // Update every 30 seconds
}

// Show loading overlay
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

// Hide loading overlay
function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// Show notification
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : 
                          type === 'error' ? 'times-circle' : 
                          'check-circle'}"></i>
        <span>${message}</span>
        <button class="notification-close"><i class="fas fa-times"></i></button>
    `;
    
    // Add styles
    const style = document.createElement('style');
    style.textContent = `
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }
        
        .notification-info {
            border-left: 4px solid var(--primary-color);
        }
        
        .notification-warning {
            border-left: 4px solid var(--warning-color);
        }
        
        .notification-error {
            border-left: 4px solid var(--danger-color);
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 0;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(notification);
    
    // Add close functionality
    notification.querySelector('.notification-close').addEventListener('click', () => {
        notification.remove();
    });
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }
    }, 5000);
}

// Load user preferences
function loadUserPreferences() {
    // Load theme preference
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        document.querySelector('#themeToggle i').classList.remove('fa-moon');
        document.querySelector('#themeToggle i').classList.add('fa-sun');
    }
    
    // Load high contrast preference
    if (localStorage.getItem('highContrast') === 'true') {
        document.body.classList.add('high-contrast');
    }
    
    // Load mode preference
    const preferredMode = localStorage.getItem('preferredMode') || 'pro';
    document.querySelector(`.mode-btn[data-mode="${preferredMode}"]`).click();
}

// Initialize on load
window.addEventListener('load', function() {
    loadUserPreferences();
    
    // Check for saved search history
    const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
    if (history.length > 0) {
        console.log('Previous searches:', history);
    }
    
    // Initialize tooltips
    initializeTooltips();
});

// Initialize tooltips
function initializeTooltips() {
    const tooltipElements = document.querySelectorAll('[title]');
    tooltipElements.forEach(el => {
        el.addEventListener('mouseenter', showTooltip);
        el.addEventListener('mouseleave', hideTooltip);
    });
}

// Show tooltip
function showTooltip(e) {
    const tooltip = document.createElement('div');
    tooltip.className = 'tooltip';
    tooltip.textContent = this.title;
    document.body.appendChild(tooltip);
    
    const rect = this.getBoundingClientRect();
    tooltip.style.left = rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + 'px';
    tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
    
    this._tooltip = tooltip;
}

// Hide tooltip
function hideTooltip() {
    if (this._tooltip) {
        this._tooltip.remove();
        this._tooltip = null;
    }
}
</script>
</body>
</html>